<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Partofa</title>
    <!-- Angulars Material CSS now available via Google CDN; version 0.8 used here -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css"/>
    <link rel="stylesheet" href="../static/css/login.css"
          th:href="@{/css/login.css}"/>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


    <script th:src="@{static/js/2.js}"></script>
    <script th:src="@{/static/js/3.js}"></script>
    <script th:src="@{/js/4.js}"></script>
    <script th:src="@{js/5.js}"></script>
    <script type="text/javascript" th:src="@{/js/6.js}"></script>
    <script src="js/5.js"></script>
    <script src="../static/js/5.js" th:src="@{/js/5.js}"></script>
    <style>
        .panel-login {
            border-color: #ccc;
            -webkit-box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.2);
        }
        .panel-login > .panel-heading {
            color: #00415d;
            background-color: #fff;
            border-color: #fff;
            text-align: center;
        }
        .panel-login > .panel-heading a {
            text-decoration: none;
            color: #666;
            font-weight: bold;
            font-size: 15px;
            -webkit-transition: all 0.1s linear;
            -moz-transition: all 0.1s linear;
            transition: all 0.1s linear;
        }
        .panel-login > .panel-heading a.active {
            color: #029f5b;
            font-size: 18px;
        }
        .panel-login > .panel-heading hr {
            margin-top: 10px;
            margin-bottom: 0px;
            clear: both;
            border: 0;
            height: 1px;
            background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
            background-image: -moz-linear-gradient(left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
            background-image: -ms-linear-gradient(left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
            background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
        }
        .panel-login input[type="text"], .panel-login input[type="email"], .panel-login input[type="password"] {
            height: 45px;
            border: 1px solid #ddd;
            font-size: 16px;
            -webkit-transition: all 0.1s linear;
            -moz-transition: all 0.1s linear;
            transition: all 0.1s linear;
        }
        .panel-login input:hover,
        .panel-login input:focus {
            outline: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
            border-color: #ccc;
        }
        .btn-login {
            background-color: #59B2E0;
            outline: none;
            color: #fff;
            font-size: 14px;
            height: auto;
            font-weight: normal;
            padding: 14px 0;
            text-transform: uppercase;
            border-color: #59B2E6;
        }
        .btn-login:hover,
        .btn-login:focus {
            color: #fff;
            background-color: #53A3CD;
            border-color: #53A3CD;
        }
        .forgot-password {
            text-decoration: underline;
            color: #888;
        }
        .forgot-password:hover,
        .forgot-password:focus {
            text-decoration: underline;
            color: #666;
        }
        .btn-register {
            background-color: #1CB94E;
            outline: none;
            color: #fff;
            font-size: 14px;
            height: auto;
            font-weight: normal;
            padding: 14px 0;
            text-transform: uppercase;
            border-color: #1CB94A;
        }
        .btn-register:hover,
        .btn-register:focus {
            color: #fff;
            background-color: #1CA347;
            border-color: #1CA347;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!--<li id="logout"><a href="/logout">Вихід</a></li>-->
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>


<div class="container">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <div class="panel panel-login">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-6">
                            <a href="#" class="active" id="login-form-link">Вхід</a>
                        </div>
                        <div class="col-xs-6">
                            <a href="#" id="register-form-link">Реєстрація</a>
                        </div>
                    </div>

                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="login-form" role="form"
                                 style="display: block;">
                                <div class="form-group">
                                    <input type="text" name="username" id="username" tabindex="1" class="form-control"
                                           placeholder="Електрона пошта" value=""/>
                                </div>
                                <div class="form-group">
                                    <input type="password" name="passwordLogin" id="passwordLogin" tabindex="2"
                                           class="form-control" placeholder="Пароль"/>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-6 col-sm-offset-3">
                                            <input  type="button" name="login-submit" id="login-submit" tabindex="4"
                                                    class="form-control btn btn-login" value="Вхід"/>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <span id="error" style="align-content: center; color: red"></span>
                                </div>
                                <div>
                                    <a style="cursor: default;" id="restorePassword">Відновити пароль</a>
                                </div>
                            </div>
                            <form action="/public/user/signup" method="post" id="register-form" role="form"
                                 style="display: none;">
                                <div class="form-group">
                                    <input type="text" name="firstName" id="firstName" tabindex="1" class="form-control"
                                           placeholder="Ім'я" value=""/>
                                </div>
                                <div class="form-group">
                                    <input type="text" name="LastName" id="lastName" tabindex="1" class="form-control"
                                           placeholder="Прізвище" value=""/>
                                </div>
                                <div class="form-group">
                                    <input type="email" name="email" id="email" tabindex="1" class="form-control"
                                           placeholder="Електрона адреса" value=""/>
                                </div>
                                <div class="form-group">
                                    <input type="password" name="password" id="password" tabindex="2"
                                           class="form-control" placeholder="Пароль"/>
                                </div>
                                <div class="form-group">
                                    <input type="password" name="passwordConfirm" id="passwordConfirm" tabindex="2"
                                           class="form-control" placeholder="Підтвердіть пароль"/>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-6 col-sm-offset-3">
                                            <input type="submit"  name="register-submit" id="register-submit"
                                                   tabindex="4" class="form-control btn btn-register"
                                                   value="Зареєструвати"/>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script>
    toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": false,
        "progressBar": false,
        "positionClass": "toast-top-right",
        "preventDuplicates": false,
        "onclick": null,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    }
    $(function () {
        $('#login-form-link').click(function (e) {
            $("#login-form").delay(100).fadeIn(100);
            $("#register-form").fadeOut(100);
            $('#register-form-link').removeClass('active');
            $(this).addClass('active');
            e.preventDefault();
        });
        $('#register-form-link').click(function (e) {
            $("#register-form").delay(100).fadeIn(100);
            $("#login-form").fadeOut(100);
            $('#login-form-link').removeClass('active');
            $(this).addClass('active');
            e.preventDefault();
        });
    });

//    $("#register-submit").click(function () {
//        $.ajax({
//            type : 'post',
//            url: "/public/user/signup",
//            data : {
//                firstName : $("#firstName").val(),
//                lastName : $("#lastName").val(),
//                email : $("#email").val(),
//                password : $("#password").val(),
//                passwordConfirm : $("#passwordConfirm").val()
//            }
//            success : function (data) {
//                toastr[success]("Ви зареєстрованні")
//            },
//            error : function () {
//                toastr[error]("Помилка")
//            }
//        })
//    })
    $("#login-submit").click(function(e){
        var dataPost = $("#login-form")
        $.ajax({
            type: 'post',
            url: '/login',
            data: {
                email: $("#username").val(),
                password: $("#passwordLogin").val()
            },
            success: function (data) {
                window.location.href = "/";
            },
            error: function(data) {
                if(data.responseJSON.message == "Authentication Failed: User is disabled"){
                    toastr["error"]("Цей користувач заблокований")
                } else {
                    toastr["error"]("Неправильно веддений логін або пароль")
                }
            }
        });
    });

    $('#register-form').on('submit', function(e) {
        (toastr["success"]("Ви зареєструвались. Очікуйте підтвердження від адміністратора")).delay( 8000 )

    });

    $('#restorePassword').click(function (e) {
        (toastr["success"]("Вам на пошту надсилається новий пароль!"));
        $.ajax({
            type: 'post',
            url: '/public/password/restore',
            data : {
                "email": $("#username").val()
            },
            success: function () {
                (toastr["success"]("Вам на пошту надіслано новий пароль!")).delay(8000);
            },
            error: function () {
                toastr["error"]("Помилка відправлення паролю. Перевірте правильність введеної пошти!");
            }
        })
    })

</script>
</html>